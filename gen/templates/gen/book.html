{% extends "base.html" %}

{% block title %}{{ book.title }} - LitLounge{% endblock %}

{% block content %}
<h2>{{ book.title }}</h2>
<p id="inline-block-child">By {{ book.author }} |</p>
<p id="inline-block-child">Genre: {{ book.genre }} |</p>
<p id="inline-block-child">Publishing date: {{ book.publishing_date }}</p>
<div id="middle">
    <p id="blurb">{{ book.blurb }}</p>
    <img id="inline-block-child" src="{{ book.cover_link }}" height="400" width="267">
</div>
<h2>Reviews</h2>
<hr>
{% for review in reviews %}
    {% if book.id == review.bookID %}
        {% for user in users %}
            {% if user.id == review.userID %}
                <br>
                <h2>{{ review.title }}</h2>
                <ul>
                <li><p id="inline-block-child">By {{ user.username }}</p></li>
                <li><img id="inline-block-child2" src="{{ url_for('static', filename=user.profile_picture) }}" width="50" height="40"></li>
                <li><p id="inline-block-child">{{ review.publishing_date }}</p></li>
                {% for i in range(0, review.rating|int) %}
                    <svg width="23" height="25">
                        <polygon id="yellowStar" points="12.5, 1.25 5.0, 24.75 23.75, 9.75 1.25, 9.75 20.0, 24.75"/>
                    </svg>
                {%endfor%}
                {% if review.rating|float % 1 != 0 %}
                    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="23" height="25">
                        <defs>
                        <linearGradient id="grad">
                            <stop offset="50%" stop-color="#fbff00"/>
                            <stop offset="50%" stop-color="#989898"/>
                        </linearGradient>
                        </defs>
                        <polygon fill="url(#grad)" points="12.5, 1.25 5.0, 24.75 23.75, 9.75 1.25, 9.75 20.0, 24.75"/>
                    </svg>
                {% endif %}
                {% for i in range(0, 4 - review.rating|int) %}
                    <svg width="23" height="25">
                        <polygon id="greyStar" points="12.5, 1.25 5.0, 24.75 23.75, 9.75 1.25, 9.75 20.0, 24.75"/>
                    </svg>
                {%endfor%}
                </ul>
                <br>
                <br>
                <p>{{ review.text }}</p>
                <br>
                {% for like in likes %}
                    {% if review.id == like.reviewID %}
                        {% with likeCount = likeCount + like.like|int %}
                            <form method="POST" action="/like">
                                <input type="hidden" name="reviewID" value="{{ review.id }}">
                                <button type="submit" id="like">üëç{{ likeCount }}</button>
                            </form>
                        {% endwith %}
                        {% with dislikeCount = dislikeCount + like.dislike|int %}
                            <form method="POST" action="/dislike">
                                <input type="hidden" name="reviewID" value="{{ review.id }}">
                                <button type="submit">üëé{{ dislikeCount }}</button>
                            </form>
                        {% endwith %}
                    {% endif %}
                {% endfor %}
            {% endif %}
        {% endfor %}
    {% endif %}
{% endfor %}
<form method="POST" action="/review">
    <input type="text" placeholder="Title" name="title" required>
    <input type="range" name="rating" min="0.5" max="5" step="0.5" value="5" class="rating" style="--val:5" oninput="this.style='--val:'+this.value" required>
    <br>
    <textarea name="review" required></textarea>
    <br>
    <button type="submit">Make a review</button>
</form>

{% endblock %}